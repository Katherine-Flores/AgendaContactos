<!DOCTYPE html> 
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Agenda de Contactos</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="	https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="d-flex justify-content-center align-items-center" style="height: 100vh;">
  <div class="container shadow-lg p-0" id="contenedor-principal">
    <div class="row align-items-stretch">
      <div class="col-md-6 pt-4 pb-4" id="contenedor-registro">
        <div class="container text-center h-100 pt-4 pb-4" id="mensaje-registro" style="display: block;">
          <div class="d-flex flex-column h-100">
            <div>
              <h1>¡Hola!</h1>
              <p>Bienvenido de nuevo. Tu red de contactos, siempre a tu alcance.</p>
            </div>
            <div class="flex-grow-1"></div>
            <div>
              <label class="col-md-12 text-start">¿Aún no tienes una cuenta?</label>
              <button class="btn-toggle w-100" type="button" onclick="toggleregistro()">REGISTRARSE</button>
            </div>
          </div>
        </div>
        <div class="container pt-4 pb-4" id="formulario-registro" style="display: none;">

          <form id="registerForm" class="row needs-validation" novalidate>

            <h5>Registro</h5>

            <div class="col-md-12 mt-2">
              <label for="usuario-registro" class="form-label">Usuario</label>
              <input type="text" class="form-control" id="usuario-registro" name="nombre_usuario" required>
              <div class="invalid-feedback">
                usuario requerido.
              </div>
            </div>

            <div class="col-md-12 mt-2">
              <label for="pass-registro" class="form-label">Contraseña</label>
              <div class="password-wrapper">
                <input type="password" id="pass-registro" class="form-control" name="contrasena" required/>
                <div class="toggle-button" data-target="pass-registro">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="eye-icon">
                     <path d="M12 15a3 3 0 100-6 3 3 0 000 6z" />
                     <path fill-rule="evenodd" d="M1.323 11.447C2.811 6.976 7.028 3.75 12.001 3.75c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113-1.487 4.471-5.705 7.697-10.677 7.697-4.97 0-9.186-3.223-10.675-7.69a1.762 1.762 0 010-1.113zM17.25 12a5.25 5.25 0 11-10.5 0 5.25 5.25 0 0110.5 0z" clip-rule="evenodd" />
                  </svg>
                </div>

                <div class="tooltip-password">
                  La contraseña debe contener:
                  <ul>
                    <li>Al menos 6 caracteres</li>
                    <li>Una letra mayúscula</li>
                    <li>Una letra minúscula</li>
                    <li>Un número</li>
                    <li>Un símbolo (@, +, $, etc.)</li>
                  </ul>
                </div>

                <div class="invalid-feedback">
                  Porfavor, ingrese su contraseña.
                </div>
              </div>
            </div>

            <div class="col-md-12 mt-2">
              <label for="confim-registro" class="form-label">Confirmar Contraseña</label>
              <div class="password-wrapper">
                <input type="password" class="form-control" id="confim-registro" name="contrasenaconfirm" required>
                <div class="toggle-button" data-target="confim-registro">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="eye-icon">
                     <path d="M12 15a3 3 0 100-6 3 3 0 000 6z" />
                     <path fill-rule="evenodd" d="M1.323 11.447C2.811 6.976 7.028 3.75 12.001 3.75c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113-1.487 4.471-5.705 7.697-10.677 7.697-4.97 0-9.186-3.223-10.675-7.69a1.762 1.762 0 010-1.113zM17.25 12a5.25 5.25 0 11-10.5 0 5.25 5.25 0 0110.5 0z" clip-rule="evenodd" />
                  </svg>
                </div>
                
                <div class="tooltip-password">
                  La contraseña debe contener:
                  <ul>
                    <li>Al menos 6 caracteres</li>
                    <li>Una letra mayúscula</li>
                    <li>Una letra minúscula</li>
                    <li>Un número</li>
                    <li>Un símbolo (@, +, $, etc.)</li>
                  </ul>
                </div>

                <div class="invalid-feedback">
                  Porfavor, confirme su contraseña.
                </div>
              </div>
            </div>

            <div class="col-md-12 mt-3">
              <button class="btn-form w-100" type="submit">REGISTRARSE</button>
            </div>

            <div>
              <button class="link-button mt-3" type="button" onclick="togglelogin()">¿Ya tienes una cuenta?</button>
            </div>
          </form>

        </div>

      </div>
      <div class="col-md-6 pt-4 pb-4" style="background-color: white;" id="contenedor-login">

        <div class="container text-center h-100 pt-4 pb-4" id="mensaje-login" style="display: none;">
          <div class="d-flex flex-column h-100">
            <div>
              <h2>Crea tu cuenta</h2>
              <p>Mantente en contacto con las personas que más importan.</p>
            </div>
            <div class="flex-grow-1"></div>
            <div>
              <label class="col-md-12 text-start">¿Ya tienes una cuenta?</label>
              <button class="btn-toggle w-100" type="button" onclick="togglelogin()">INICIAR SESIÓN</button>
            </div>
          </div>
        </div>

        <div class="container pt-4 pb-4" id="formulario-login" style="display: block;">

          <form id="loginForm" class="row needs-validation" novalidate>

            <h5>INICIO DE SESIÓN</h5>

            <div class="col-md-12 mt-2">
              <label for="validationCustom01" class="form-label">Usuario</label>
              <input type="text" class="form-control" id="validationCustom01" name="nombre_usuario_login" required>
              <div class="invalid-feedback">
                usuario requerido.
              </div>
            </div>

            <div class="col-md-12 mt-2">
               <label for="password-field" class="form-label">Contraseña</label>

               <div class="password-wrapper">
                  <input type="password" id="password-field" class="form-control" name="contrasena_login" required/>
                  <div class="toggle-button"  data-target="password-field">
                     <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="eye-icon">
                        <path d="M12 15a3 3 0 100-6 3 3 0 000 6z" />
                        <path fill-rule="evenodd" d="M1.323 11.447C2.811 6.976 7.028 3.75 12.001 3.75c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113-1.487 4.471-5.705 7.697-10.677 7.697-4.97 0-9.186-3.223-10.675-7.69a1.762 1.762 0 010-1.113zM17.25 12a5.25 5.25 0 11-10.5 0 5.25 5.25 0 0110.5 0z" clip-rule="evenodd" />
                     </svg>
                  </div>
                  <div class="invalid-feedback">
                    Porfavor, ingrese su contraseña.
                  </div>
               </div>
            </div>
            
            <div class="col-md-12 mt-3">
              <button class="btn-form w-100" type="submit">INICIAR SESIÓN</button>
            </div>

            <div>
              <button class="link-button mt-3" type="button" onclick="toggleregistro()">¿Aún no tienes una cuenta?</button>
            </div>

          </form>
        </div>

      </div>
    </div>
  </div>

  <div id="resultado"></div>

<script>
  const registerForm = document.getElementById('registerForm');
  const loginForm = document.getElementById('loginForm');

  // Validar contraseña segura
  function validarContrasenaFuerte(pass) {
    const regex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_]).{6,}$/;
    return regex.test(pass);
  }

  registerForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const usuario = registerForm.nombre_usuario.value;
    const pass = registerForm.contrasena.value;
    const confirm = document.getElementById('confim-registro').value;

    if (pass !== confirm) {
      Swal.fire('Error', 'Las contraseñas no coinciden', 'error');
      return;
    }

    if (!validarContrasenaFuerte(pass)) {
      Swal.fire('Error', 'La contraseña debe tener mayúsculas, minúsculas, número y símbolo', 'error');
      return;
    }

    const res = await fetch('http://localhost:3000/api/auth/register', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ nombre_usuario: usuario, contrasena: pass })
    });

    const json = await res.json();

    if (res.ok) {
      Swal.fire('¡Registro exitoso!', json.message, 'success');
      registerForm.reset();
    } else {
      Swal.fire('Error', json.error || 'No se pudo registrar', 'error');
    }
  });

  loginForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const data = new FormData(loginForm);
    const res = await fetch('http://localhost:3000/api/auth/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        nombre_usuario: data.get('nombre_usuario_login'),
        contrasena: data.get('contrasena_login')
      })
    });
    const json = await res.json();

    if (res.ok) {
      localStorage.setItem('token', json.token);
      console.log('TOKEN GUARDADO:', localStorage.getItem('token'));

      Swal.fire({
        title: '¡Login exitoso!',
        text: json.message,
        icon: 'success',
        confirmButtonText: 'Ir al Dashboard'
      }).then(() => {
        window.location.href = 'dashboard.html';
      });
    } else {
      Swal.fire('Error', json.error || 'No se pudo iniciar sesión', 'error');
    }
  });
</script>

<!-- Script Bootstrap Validacion -->
<script>
  // Example starter JavaScript for disabling form submissions if there are invalid fields
  (() => {
    'use strict'

    // Fetch all the forms we want to apply custom Bootstrap validation styles to
    const forms = document.querySelectorAll('.needs-validation')

    // Loop over them and prevent submission
    Array.from(forms).forEach(form => {
      form.addEventListener('submit', event => {
        if (!form.checkValidity()) {
          event.preventDefault()
          event.stopPropagation()
        }

        form.classList.add('was-validated')
      }, false)
    })
  })()
</script>

<!-- Script de style -->
<script>
  const rootStyles = getComputedStyle(document.documentElement);
  const azulOscuro = rootStyles.getPropertyValue('--azul-oscuro').trim();
  const azulMedio = rootStyles.getPropertyValue('--azul-medio').trim();
  const azulClaro = rootStyles.getPropertyValue('--azul-claro').trim();
  const fondoClaro = rootStyles.getPropertyValue('--fondo-claro').trim();

  function esPantallaPequena() {
    return window.innerWidth <= 900;
  }

  function toggleregistro() {
    const mensaje = document.getElementById("mensaje-registro");
    const formulario = document.getElementById("formulario-registro");
    const contenedor = document.getElementById("contenedor-registro");
    const mensaje2 = document.getElementById("mensaje-login");
    const formulario2 = document.getElementById("formulario-login");
    const contenedor2 = document.getElementById("contenedor-login");

    if (esPantallaPequena()) {
      // En móviles/tablets solo se muestra el formulario de registro
      mensaje.style.display = 'none';
      formulario.style.display = 'block';
      contenedor.style.display = 'block';

      mensaje2.style.display = 'none';
      formulario2.style.display = 'none';
      contenedor2.style.display = 'none';
    } else {
      // En pantallas grandes, se muestran ambos lados
      mensaje.style.display = 'none';
      formulario.style.display = 'block';
      contenedor.style.display = 'block';
      contenedor.style.backgroundColor = 'white';
      contenedor.style.color = azulOscuro;

      mensaje2.style.display = 'block';
      formulario2.style.display = 'none';
      contenedor2.style.display = 'block';
      contenedor2.style.backgroundColor = azulMedio;
      contenedor2.style.color = 'white';
    }
  }

  function togglelogin() {
    const mensaje = document.getElementById("mensaje-login");
    const formulario = document.getElementById("formulario-login");
    const contenedor = document.getElementById("contenedor-login");
    const mensaje2 = document.getElementById("mensaje-registro");
    const formulario2 = document.getElementById("formulario-registro");
    const contenedor2 = document.getElementById("contenedor-registro");

    if (esPantallaPequena()) {
      // En móviles/tablets solo se muestra el formulario de login
      mensaje.style.display = 'none';
      formulario.style.display = 'block';
      contenedor.style.display = 'block';

      mensaje2.style.display = 'none';
      formulario2.style.display = 'none';
      contenedor2.style.display = 'none';
    } else {
      // En pantallas grandes, se muestran ambos lados
      mensaje.style.display = 'none';
      formulario.style.display = 'block';
      contenedor.style.display = 'block';
      contenedor.style.backgroundColor = 'white';
      contenedor.style.color = azulOscuro;

      mensaje2.style.display = 'block';
      formulario2.style.display = 'none';
      contenedor2.style.display = 'block';
      contenedor2.style.backgroundColor = azulMedio;
      contenedor2.style.color = 'white';
    }
  }

  window.addEventListener('DOMContentLoaded', () => {
    const mensaje = document.getElementById("mensaje-login");
    const formulario = document.getElementById("formulario-login");
    const contenedor = document.getElementById("contenedor-login");
    const mensaje2 = document.getElementById("mensaje-registro");
    const formulario2 = document.getElementById("formulario-registro");
    const contenedor2 = document.getElementById("contenedor-registro");

    if (esPantallaPequena()) {
      // En móviles solo mostrar login
      mensaje.style.display = 'none';
      formulario.style.display = 'block';
      contenedor.style.display = 'block';

      mensaje2.style.display = 'none';
      formulario2.style.display = 'none';
      contenedor2.style.display = 'none';
    } else {
      // En pantallas grandes, mostrar login con mensaje y registro con mensaje
      mensaje.style.display = 'none';
      formulario.style.display = 'block';
      contenedor.style.display = 'block';
      contenedor.style.backgroundColor = 'white';
      contenedor.style.color = azulOscuro;

      mensaje2.style.display = 'block';
      formulario2.style.display = 'none';
      contenedor2.style.display = 'block';
      contenedor2.style.backgroundColor = azulMedio;
      contenedor2.style.color = 'white';
    }
  });
</script>
</body>

<!-- Script mostrar/ocultar pass -->
<!--<script>
  const eyeIcons = {
    open: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="eye-icon"><path d="M12 15a3 3 0 100-6 3 3 0 000 6z" /><path fill-rule="evenodd" d="M1.323 11.447C2.811 6.976 7.028 3.75 12.001 3.75c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113-1.487 4.471-5.705 7.697-10.677 7.697-4.97 0-9.186-3.223-10.675-7.69a1.762 1.762 0 010-1.113zM17.25 12a5.25 5.25 0 11-10.5 0 5.25 5.25 0 0110.5 0z" clip-rule="evenodd" /></svg>',
    closed: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="eye-icon"><path d="M3.53 2.47a.75.75 0 00-1.06 1.06l18 18a.75.75 0 101.06-1.06l-18-18zM22.676 12.553a11.249 11.249 0 01-2.631 4.31l-3.099-3.099a5.25 5.25 0 00-6.71-6.71L7.759 4.577a11.217 11.217 0 014.242-.827c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113z" /><path d="M15.75 12c0 .18-.013.357-.037.53l-4.244-4.243A3.75 3.75 0 0115.75 12zM12.53 15.713l-4.243-4.244a3.75 3.75 0 004.243 4.243z" /><path d="M6.75 12c0-.619.107-1.213.304-1.764l-3.1-3.1a11.25 11.25 0 00-2.63 4.31c-.12.362-.12.752 0 1.114 1.489 4.467 5.704 7.69 10.675 7.69 1.5 0 2.933-.294 4.242-.827l-2.477-2.477A5.25 5.25 0 016.75 12z" /></svg>'
  };

  function addListeners() {
    const toggleButton = document.querySelector(".toggle-button");
    
    if (!toggleButton) {
        return;
    }
    
    toggleButton.addEventListener("click", togglePassword);
  }

  function togglePassword() {
    const passwordField = document.querySelector("#password-field");
    const toggleButton = document.querySelector(".toggle-button");
    
    if (!passwordField || !toggleButton) {
        return;
    }
    
    toggleButton.classList.toggle("open");
    
    const isEyeOpen = toggleButton.classList.contains("open");

    toggleButton.innerHTML = isEyeOpen ? eyeIcons.closed : eyeIcons.open;
    passwordField.type = isEyeOpen ? "text" : "password";
  }

  document.addEventListener("DOMContentLoaded", addListeners);
</script>-->
<script>
  const eyeIcons = {
    open: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="eye-icon"><path d="M12 15a3 3 0 100-6 3 3 0 000 6z" /><path fill-rule="evenodd" d="M1.323 11.447C2.811 6.976 7.028 3.75 12.001 3.75c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113-1.487 4.471-5.705 7.697-10.677 7.697-4.97 0-9.186-3.223-10.675-7.69a1.762 1.762 0 010-1.113zM17.25 12a5.25 5.25 0 11-10.5 0 5.25 5.25 0 0110.5 0z" clip-rule="evenodd" /></svg>',
    closed: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="eye-icon"><path d="M3.53 2.47a.75.75 0 00-1.06 1.06l18 18a.75.75 0 101.06-1.06l-18-18zM22.676 12.553a11.249 11.249 0 01-2.631 4.31l-3.099-3.099a5.25 5.25 0 00-6.71-6.71L7.759 4.577a11.217 11.217 0 014.242-.827c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113z" /><path d="M15.75 12c0 .18-.013.357-.037.53l-4.244-4.243A3.75 3.75 0 0115.75 12zM12.53 15.713l-4.243-4.244a3.75 3.75 0 004.243 4.243z" /><path d="M6.75 12c0-.619.107-1.213.304-1.764l-3.1-3.1a11.25 11.25 0 00-2.63 4.31c-.12.362-.12.752 0 1.114 1.489 4.467 5.704 7.69 10.675 7.69 1.5 0 2.933-.294 4.242-.827l-2.477-2.477A5.25 5.25 0 016.75 12z" /></svg>'
  };

  function addToggleListeners() {
    const toggleButtons = document.querySelectorAll(".toggle-button");

    toggleButtons.forEach(button => {
      // Agrega ícono inicial (abierto)
      button.innerHTML = eyeIcons.open;

      button.addEventListener("click", () => {
        const inputId = button.dataset.target;
        const input = document.getElementById(inputId);

        if (!input) return;

        const isOpen = button.classList.toggle("open");
        input.type = isOpen ? "text" : "password";
        button.innerHTML = isOpen ? eyeIcons.closed : eyeIcons.open;
      });
    });
  }

  document.addEventListener("DOMContentLoaded", addToggleListeners);
</script>

</html>
