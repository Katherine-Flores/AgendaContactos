<!DOCTYPE html> 
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Agenda de Contactos - Login y Registro</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="	https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="d-flex justify-content-center align-items-center" style="height: 100vh;">
  <div class="container" style="border-radius: 32px; box-shadow: 0px 30px 60px rgba(138, 149, 158, 0.2);">

    <div class="row align-items-start">

      <div class="col-md-6" id="contenedor-registro">
        <div class="container text-center contenedor" id="mensaje-registro" style="display: block;">
          <h1>¡Hola!</h1>
          <p>Bienvenido de nuevo.<br> Tu red de contactos, siempre a tu alcance.</p>
          <div class="ultimo">
            <label for="gotoRegistrarse" class="form-label col-md-12">¿Aún no tienes una cuenta?</label>
            <button type="button" onclick="toggleregistro()">REGISTRARSE</button>
          </div>
        </div>
        <div class="container contenedor" id="formulario-registro" style="display: none;">

          <form id="registerForm" class="row needs-validation" novalidate>

            <h2>Registro</h2>

            <div class="col-md-12 mt-2">
              <label for="validationCustom01" class="form-label">Usuario</label>
              <input type="text" class="form-control" id="validationCustom01" name="nombre_usuario" required>
              <div class="invalid-feedback">
                usuario requerido.
              </div>
              <div class="valid-feedback">
                correcto.
              </div>
            </div>

            <div class="col-md-12 mt-2">
              <label for="validationCustom02" class="form-label">Contraseña</label>
              <input type="password" class="form-control" id="validationCustom02" name="contrasena" required>
              <div class="invalid-feedback">
                Porfavor, ingrese su contraseña.
              </div>
              <div class="valid-feedback">
                correcto.
              </div>
            </div>

            <div class="col-md-12 mt-2">
              <label for="validationCustom03" class="form-label">Confirmar Contraseña</label>
              <input type="password" class="form-control" id="validationCustom03" name="contrasena" required>
              <div class="invalid-feedback">
                Porfavor, ingrese su contraseña.
              </div>
              <div class="valid-feedback">
                correcto.
              </div>
            </div>

            <button type="submit">REGISTRARSE</button>

          </form>

        </div>

      </div>

      <div class="col-md-6" style="background-color: white;" id="contenedor-login">

        <div class="container text-center contenedor" id="mensaje-login" style="display: none;">
          <h1>Crea tu cuenta</h1>
          <p>Mantente en contacto con las<br> personas que más importan.</p>
          <label for="gotoRegistrarse" class="form-label col-md-12">¿Ya tienes una cuenta?</label>
          <button type="button" onclick="togglelogin()">INICIAR SESIÓN</button>
        </div>

        <div class="container contenedor" id="formulario-login" style="display: block;">

          <form id="loginForm" class="row needs-validation" novalidate>

            <h2>Login</h2>

            <div class="col-md-12 mt-2">
              <label for="validationCustom01" class="form-label">Usuario</label>
              <input type="text" class="form-control" id="validationCustom01" name="nombre_usuario" required>
              <div class="invalid-feedback">
                usuario requerido.
              </div>
              <div class="valid-feedback">
                correcto.
              </div>
            </div>

            <div class="col-md-12 mt-2">
              <label for="validationCustom02" class="form-label">Contraseña</label>
              <input type="password" class="form-control" id="validationCustom02" name="contrasena" required>
              <div class="invalid-feedback">
                Porfavor, ingrese su contraseña.
              </div>
              <div class="valid-feedback">
                correcto.
              </div>
            </div>

            <button class="align-items-end" type="submit">Iniciar Sesión</button>

          </form>
        </div>

      </div>

    </div>

  </div>

  <div id="resultado"></div>

<script>
  const registerForm = document.getElementById('registerForm');
  const loginForm = document.getElementById('loginForm');

  registerForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const data = new FormData(registerForm);
    const res = await fetch('http://localhost:3000/api/auth/register', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        nombre_usuario: data.get('nombre_usuario'),
        contrasena: data.get('contrasena')
      })
    });
    const json = await res.json();

    if (res.ok) {
      Swal.fire('¡Registro exitoso!', json.message, 'success');
      registerForm.reset();
    } else {
      Swal.fire('Error', json.error || 'No se pudo registrar', 'error');
    }
  });

  loginForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const data = new FormData(loginForm);
    const res = await fetch('http://localhost:3000/api/auth/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        nombre_usuario: data.get('nombre_usuario'),
        contrasena: data.get('contrasena')
      })
    });
    const json = await res.json();

    if (res.ok) {
      localStorage.setItem('token', json.token);
      Swal.fire({
        title: '¡Login exitoso!',
        text: json.message,
        icon: 'success',
        confirmButtonText: 'Ir al Dashboard'
      }).then(() => {
        window.location.href = 'dashboard.html'; // Cambia esto si tu dashboard tiene otro nombre
      });
    } else {
      Swal.fire('Error', json.error || 'No se pudo iniciar sesión', 'error');
    }
  });
</script>
<script>
  // Example starter JavaScript for disabling form submissions if there are invalid fields
  (() => {
    'use strict'

    // Fetch all the forms we want to apply custom Bootstrap validation styles to
    const forms = document.querySelectorAll('.needs-validation')

    // Loop over them and prevent submission
    Array.from(forms).forEach(form => {
      form.addEventListener('submit', event => {
        if (!form.checkValidity()) {
          event.preventDefault()
          event.stopPropagation()
        }

        form.classList.add('was-validated')
      }, false)
    })
  })()
</script>

<!-- Script de style-->
<script>
  const rootStyles = getComputedStyle(document.documentElement);
  
  // Extraer las variables
  const azulOscuro = rootStyles.getPropertyValue('--azul-oscuro').trim();
  const azulMedio = rootStyles.getPropertyValue('--azul-medio').trim();
  const azulClaro = rootStyles.getPropertyValue('--azul-claro').trim();
  const fondoClaro = rootStyles.getPropertyValue('--fondo-claro').trim();

  function toggleregistro(){
    const mensaje = document.getElementById("mensaje-registro");
    const formulario = document.getElementById("formulario-registro");
    const contenedor = document.getElementById("contenedor-registro");
    const mensaje2 = document.getElementById("mensaje-login");
    const formulario2 = document.getElementById("formulario-login");
    const contenedor2 = document.getElementById("contenedor-login");
  
    mensaje.style.display = 'none';
    formulario.style.display = 'block';
    contenedor.style.backgroundColor = 'white';
    contenedor.style.color = azulOscuro;

    mensaje2.style.display = 'block';
    formulario2.style.display = 'none';
    contenedor2.style.backgroundColor = azulMedio;
    contenedor2.style.color = 'white';
  }

  function togglelogin(){
    const mensaje = document.getElementById("mensaje-login");
    const formulario = document.getElementById("formulario-login");
    const contenedor = document.getElementById("contenedor-login");
    const mensaje2 = document.getElementById("mensaje-registro");
    const formulario2 = document.getElementById("formulario-registro");
    const contenedor2 = document.getElementById("contenedor-registro");

    mensaje.style.display = 'none';
    formulario.style.display = 'block';
    contenedor.style.backgroundColor = 'white';
    contenedor.style.color = azulOscuro;

    mensaje2.style.display = 'block';
    formulario2.style.display = 'none';
    contenedor2.style.backgroundColor = azulMedio;
    contenedor2.style.color = 'white';
  }
</script>
</body>
</html>
